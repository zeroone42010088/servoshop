window.__jivoOnError=function(e){if(navigator.userAgent.search(/google/gi)===-1&&navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi)===-1)try{var t=window.location.protocol+"//err.jivosite.com/widget",o="POST",n={widget:"true",widget_version:window.jivo_version,level:2,url:window.location.href,user_agent:navigator.userAgent,lineNumber:e&&e.lineNumber,fileName:e&&e.fileName,column:e&&e.columnNumber,full_message:e&&e.stack,short_message:e&&e.message},r=new XMLHttpRequest;"withCredentials"in r?r.open(o,t,!0):"undefined"!=typeof XDomainRequest&&(r=new XDomainRequest,r.open(o,t)),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(n))}catch(e){}},function(){function e(e,t,o,n){function r(e){if(Q("Loading config from",e),T())return void oe.error("This widget is permanently removed");var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e,n=R(o);try{e=JSON.parse(n)}catch(e){Q("Config is loaded as JSONP");var r=t.getElementsByTagName("script"),a=r[0],l=t.createElement("script");M(l),l.innerHTML=n,a.parentNode.insertBefore(l,a)}e&&(Q("Config is loaded",e),i(e))}else 0!==o.status&&B()},o.open("GET",e+"?rnd="+Math.random(),!0),o.send(null)}function i(e){if(e.isDeleted)return void k();if(Ee!==e.base_url)return Q("Wrong config host",Ee),Ee=e.base_url,void r(S());if(e.regions&&!Ne.isChatStarted){var t=O(e);if(t.widgetId!==Te)return Q("Wrong geo-widget widgetId",Te),w("geoWidgetInfo",t),Te=t.widgetId,void r(S())}w("configHost",Ee),l(e)}function a(e,t){return[e,t].reduce(function(e,t){return Object.keys(t).forEach(function(o){e[o]=t[o]}),e},{})}function l(t){if(w("log",!!t.logs),"[object Object]"===Object.prototype.toString.call(e.wix_context)&&"[object Object]"===Object.prototype.toString.call(e.jivo_wix)&&(t=a(t,e.jivo_wix)),e.jivo_config=ne=t,x())throw Q("Host is blacklisted",e.location.host),new Error("Placing widget is forbidden on "+e.top.location.host);if(fe&&ne.disable_mobile)return void Q("Mobile widget is disabled");s()}function s(){"complete"==t.readyState?d():Ne.bundleLoaded&&Ne.buildNumber==ne.build_number?"interactive"==t.readyState?d():z(e,"DOMContentLoaded",d):(w("bundleLoaded",!1),z(e,"load",d))}function d(){Q("Widget initialization"),W(),c(),F()}function c(){Q("Iframe initialization"),ge.src="javascript:void(0)",ge.title="",ge.role="presentation",ge.allow="autoplay",ge.setAttribute("name","jivo_container"),ge.setAttribute("id","jivo_container"),ge.setAttribute("frameborder","no"),ve.className+="jivo-no-transition","undefined"==typeof SVGRect&&(ve.className+=" no-svg"),(ge.frameElement||ge).style.cssText="width:100%;height:100%;border:0",e.jivo_init=function(){me=0;var o=t.createEvent("Event");o.initEvent("jBeforeunload",!0,!0),e.dispatchEvent(o),u()},e.atob&&"complete"!==t.readyState?z(e,"load",u):u(),z(e,"message",function(o){if(!o)return void(oe&&oe.log&&oe.log("Error receive postMessage, window message event is empty."));var n,r,i=o.data;if("in_node_webkit"==i.name&&(n||(n=o.source,r=o.origin),n&&r)){e.jivo_cobrowse={source:n,origin:r};var a="jv_"+encodeURIComponent("langpack")+"_"+ne.widget_id+"="+encodeURIComponent(JSON.stringify(i.langpack));ne.cookie_domain&&(a+="; domain="+ne.cookie_domain),a+="; path=/",t.cookie=a,n.postMessage({name:"widget_ready"},r)}"iframe_url_changed"!=i.name&&"iframe_url_changed"!=i||p()},!1)}function u(){var e=U();D()||e===ne.base_url?g(e):f(e)}function f(e){Q("Pinging host",e);var t=new XMLHttpRequest,o=U(!0)+"/ping?rand="+(new Date).getTime();t.onreadystatechange=function(){if(4===t.readyState)if(204===t.status){clearTimeout(le),Q("Host is available",e);var o={type:Ne.availableHostInfo.type,retriesCount:_e,host:e};w("availableHostInfo",o),w("buildNumber",ne.build_number),g(e)}else 0!==t.status&&(Q("Ping host error",e),q("error",e,t.status))},t.open("GET",o,!0),t.send(null),X()}function g(e){Q("Insertion of bundle code from",e);var o=t.getElementsByTagName("head")[0],n=t.createElement("script"),r=J(e);ce=ce||(new Date).getTime(),M(n),n.className="js-jivo-bundle",n.src=r,ue.bundleSrc=r,n.onerror=function(){q("error",e)},o.appendChild(n)}function v(e){clearTimeout(le),se=e;var t=((new Date).getTime()-ce)/1e3;t>6&&w("loadTime",t),w("bundleLoaded",!0),Q("Bundle is loaded"),m()}function m(){ae=t.body.lastChild,ve.style&&(ve.style.opacity="0",ve.style.visibility="hidden"),ve.setAttribute("id","jivo-iframe-container"),ve.appendChild(ge),ae?ae.parentNode.insertBefore(ve,ae.nextSibling):t.body.appendChild(ve),p()}function p(){if(!(me++>3)){if(!se)return me--,u();try{ie=ge.contentWindow.document}catch(e){re=t.domain,ge.src="javascript:var d=document.open();d.domain='"+re+"';void(0);",ie=ge.contentWindow.document}var e="<!doctype HTML>",o='<meta name="google" content="notranslate"><meta http-equiv="X-UA-Compatible" content="IE=edge" />',n="<script type=\"text/javascript\">window.onerror = function (message, url, lineNumber, columnNumber, error) {    if (error && error.error) {        error = error.error;    }    if (!error || !(error instanceof Error)) {        error = {};    }    if (error.stack) {        error.stack = error.message + ' ' + error.stack;    }    error.message = 'Bundle init error';    error.columnNumber = columnNumber;    error.lineNumber = lineNumber;    error.url = url;    window.parent.__jivoOnError(error);};"+se+"</script>",r="<head>"+o+n+"</head>",i='<body class="notranslate"><div id="widget"></div><div id="player"></div></body>';ie.write(e+r+i),ie.close()}}function b(){var e={isChatStarted:null,geoWidgetInfo:{widgetId:null,clientLocation:null,region:null},configHost:null,deletedInfo:{widgetId:null,resolveTime:null},availableHostInfo:{retriesCount:null,type:null,host:null},buildNumber:null,bundleLoaded:null,isNewCode:null,loadTime:null,log:null};if(ue.hasStorage){var t=JSON.parse(localStorage.getItem("jv_loader_info"));t&&h(t,e)}return e}function w(e,t){if(Ne[e]=t,ue.hasStorage){var o={};h(Ne,o),localStorage.setItem("jv_loader_info",JSON.stringify(o))}}function h(e,t){var o=Object.keys(e);o.forEach(function(o){_(e[o])||(t[o]=e[o])})}function _(e){if(y(e))return!0;if("object"==typeof e){for(var t=Object.keys(e),o=0;o<t.length;o++)if(!y(e[t[o]]))return!1;return!0}}function y(e){return null===e&&"object"==typeof e}function j(){if(t.currentScript&&t.currentScript.src)return t.currentScript.src;try{throw new Error("Get script URL")}catch(t){var e=t.stack,o=C(e),n=N(e),r=E(e);return o?o[0]:n?n[0]:r?r[0]:null}}function S(){return Ee+"/script/widget/config/"+Te}function I(){Ee=Ne.configHost,Te=Ne.geoWidgetInfo.widgetId;var e=j(),o=C(e),n=N(e),r=E(e);if(Ee||(o?(Ee="//"+o[1],w("isNewCode",!0)):n?Ee="//"+n[1]:r&&(Ee="//"+r[1])),!Te)if(n&&n[2])Te=n[2],w("isNewCode",!1);else if(r&&r[2])Te=r[2],w("isNewCode",!1);else if(w("isNewCode",!0),t.currentScript)Te=t.currentScript.getAttribute("jv-id");else{var i=t.querySelector("script[jv-id]");i&&(Te=i.getAttribute("jv-id"))}}function C(e){return e.match(/https?:\/\/(\S+)\/widget\.js/)}function N(e){return e.match(/https?:\/\/(\S+)\/script\/widget\/([A-Za-z0-9]+)/)}function E(e){return e.match(/https?:\/\/(\S+)\/script\/geo-widget\/([A-Za-z0-9]+)/)}function T(){return!!(Ne.deletedInfo.widgetId&&Ne.deletedInfo.widgetId===Te&&Ne.deletedInfo.resolveTime&&parseInt(Ne.deletedInfo.resolveTime)>=(new Date).getTime())}function L(e,t,o){return{widgetId:e,region:t,clientLocation:o}}function O(e){var t,o,n=e.regions,r=H(e.geoip);if(n){for(var i=Object.keys(n),a=0;a<i.length;a++)for(var l=n[i[a]],s=0;s<l.length;s++)if(1!=l.length||"default"!==l[s]){var d=H(l[s]);if(r.country===d.country){if(r.region===d.region)return L(i[a],l[s],e.geoip);o||d.region||(o=L(i[a],l[s],e.geoip))}}else t=i[a];if(o)return o;if(t)return L(t,"default",e.geoip)}}function H(e){if("string"==typeof e&&""!==e){var t=e.split(";");return{country:t[0],region:t[1],city:t[2]}}}function k(){Q("Widget was removed",Te),w("configHost",null),Ne.geoWidgetInfo.widgetId||Ne.isChatStarted?(w("geoWidgetInfo",L(null,null,null)),w("isChatStarted",null),A()):(w("deletedInfo",{widgetId:Te,resolveTime:((new Date).getTime()+he).toString()}),oe.error("This widget is permanently removed"))}function B(){if(Q("Config loading error"),ye>we){Q("Config load retries count is exceeded");var t=new Error("Config not loaded. Responce status code "+xhr.status);e.__jivoOnError(t)}else ye++,w("geoWidgetInfo",L(null,null,null)),w("isChatStarted",null),w("configHost",null),A()}function A(){Te=null,Ee=null,I()}function M(e){return e.type="text/javascript",e.async=!0,e.charset="UTF-8",e}function R(e){var t;return t=e.responseType&&"text"!==e.responseType?"document"===e.responseType?e.responseXML:e.response:e.responseText}function x(){return void 0!==ne.host_blacklist&&ne.host_blacklist.indexOf(e.location.host)>=0}function W(){if("string"==typeof ne.geoip&&""!==ne.geoip){var e=ne.geoip.split(";")[0];null!==P(e)&&(Ce=e)}if(!D()){var t={type:Ne.availableHostInfo.type,retriesCount:Ne.availableHostInfo.retriesCount,host:null};w("availableHostInfo",t),w("buildNumber",null)}var o=ne.static_host?ne.static_host.split("/"):[];Ie=o[1]?"/"+o[1]:"";var n=Ne.availableHostInfo;_e=n.retriesCount?n.retriesCount:_e,_e>4&&(_e=4),de=P(Ce)}function P(e){var t=Object.keys(Se),o=null;return t.forEach(function(t){if(!o){var n=Se[t];n.indexOf(e)!==-1&&(o=t)}}),o}function D(){var e=Ne.availableHostInfo;return e.buildNumber===ne.build_number&&e.host}function U(e){var t,o=e?"":Ie;return D()?t=Ne.availableHostInfo.host:0===_e?(de=P(Ce),t=je[de]+o):1===_e?(de=V(Se,de),t=je[de]+o):t=ne.base_url,t}function V(e,t){var o=Object.keys(e),n=G(o);return n===t?V(e,t):n}function G(e){return e[Math.floor(Math.random()*e.length)]}function J(e){var t=ne.bundle_folder?ne.bundle_folder:"";return e+t+"/js/bundle_"+ne.locale+".js?rand="+ne.build_number}function q(t,o,n){if(clearTimeout(le),++_e>=be){Q("Bundle load retries count is exceeded");var r="Bundle not loaded. Type: "+t,i=o?". Host: "+o:"",a=n?". Status code: "+n:"",l=new Error(r+i+a);return void e.__jivoOnError(l)}var s={type:t,retriesCount:_e,host:null};Ne.availableHostInfo=s,u()}function X(){le=setTimeout(function(){q("timeout")},pe)}function z(t,o,n){t.addEventListener?t.addEventListener(o,n,!1):t.attachEvent&&(t.attachEvent("on"+o,function(t){return function(){n.call(t,e.event)}}(t)),t=null)}function F(){ne.cp_tracker_id&&ne.cp_tracker_url&&(e._cp={trackerId:ne.cp_tracker_id},Z(ne.cp_tracker_url))}function Z(e,o){var n=o||t,r=n.getElementsByTagName("script"),i=r[0],a=n.createElement("script");M(a),i.parentNode.insertBefore(a,i).src=e}function K(e){e.loaderContext=ue,e.globalStore=ue,Y()}function Y(){se=null;for(var e=t.getElementsByTagName("head")[0],o=e.getElementsByClassName("js-jivo-bundle"),n=0;n<o.length;n++)o[n].parentNode&&(o[n].parentNode.removeChild(o[n]),o[n]=null);o=null}function Q(){if(Ne.log){var e=Array.prototype.slice.call(arguments||[]);e.unshift("Loader:"),oe.log.apply(oe,e)}}function $(){return!!e.WebSocket}function ee(e){i(e)}function te(){k()}if(!oe)var oe={log:function(){},error:function(){}};if(!$())return void oe.log("Not supported browser");if("undefined"==typeof e.jivo_magic_var){e.jivo_magic_var=!0;var ne,re,ie,ae,le,se,de,ce,ue={hasStorage:e.__hasStorage,jivoLoaderVersion:o,loadScript:Z,currentLoaderVersionCache:n},fe=/iPhone|iPad|iPod|Android|Windows Phone/i.test(navigator.userAgent),ge=t.createElement("iframe"),ve=t.createElement("div"),me=0,pe=5e3,be=5,we=3,he=6048e5,_e=0,ye=0,je=[["//cdn-fr.jivosite.com"],["//cdn-cis.jivosite.com"],["//cdn-ca.jivosite.com"]],Se={0:["default"],1:["RU","KZ","UA","BY"],2:["US","CA","AG","BS","BB","BZ","HT","GT","HN","GD","DM","DO","MX","NI","PA","SV","LC","VC","KN","TT","JM","CR","CU","AR","BR","BO","VE","GY","CO","PY","PE","SR","UY","CL","EC","AU","VU","KI","MH","FM","NR","NZ","PW","PG","WS","SB","TK","TV","FJ","PH"]},Ie="",Ce="default",Ne=b();Q("Initialization"),e.__jivoBundleOnLoad=v,e.__jivoBundleInit=K,ue.getHostURL=U,ue.loadConfig=r,ue.store=Ne,ue.setInStore=w;var Ee,Te;I(),Te&&Ee?(Q("widgetId:",Te,"configHost:",Ee),r(S())):Te&&Ee||oe.error("Failed to evaluate the widgetId or configHost"),e.__jivoConfigOnLoad=ee,e.__jivoCacheDeletedWidget=te}}var t=.1;window.__hasStorage=!1;try{localStorage.setItem("testLocalStorage","ok"),localStorage.removeItem("testLocalStorage"),window.__hasStorage=!0}catch(e){}var o=e,n=null;if(window.__hasStorage){try{n=JSON.parse(localStorage.getItem("__jivoLoader"))}catch(e){e.message="Loader parse error",window.__jivoOnError(e)}n&&n.version>t&&(o=new Function("window","document","broswerCacheLoaderVersion","currentLoaderVersionCache","("+n.code+")(window, document, broswerCacheLoaderVersion, currentLoaderVersionCache)"))}try{o(window,document,t,n?n.version:t)}catch(n){n.message=n.message?"Loader error. "+n.message:"Loader error",window.__jivoOnError(n),delete window.jivo_magic_var,o=e,o(window,document,t,t)}}();